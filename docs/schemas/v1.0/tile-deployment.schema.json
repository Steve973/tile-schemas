{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://tessera.dev/schemas/tile-config.schema.json",
  "title": "TileDeployment",
  "description": "Schema for a Tessera Tile declaration.",
  "type": "object",
  "properties": {
    "tileId": {
      "type": "string",
      "description": "Unique identifier for the tile."
    },
    "tileVersion": {
      "type": "string",
      "description": "Semantic version (e.g., 1.0.0)."
    },
    "displayName": {
      "type": "string",
      "description": "Human-readable name of the tile."
    },
    "category": {
      "type": "string",
      "description": "Tile category (e.g., analytics)."
    },
    "subcategory": {
      "type": "string",
      "description": "Tile subcategory (e.g., graph/social-media/influence). Use '.' to opt out of hierarchy.",
      "pattern": "^\\.$|^[a-zA-Z0-9._-]+(/[a-zA-Z0-9._-]+)*$"
    },
    "type": {
      "type": "string",
      "description": "Tile type (e.g., analytic, ingest, embedding)."
    },
    "tags": {
      "type": "array",
      "description": "Tags for filtering or classification.",
      "items": { "type": "string" }
    },
    "description": {
      "type": "string",
      "description": "Description of the tile’s purpose or behavior."
    },
    "supportedProtocols": {
      "type": "array",
      "description": "Protocols the tile supports (e.g., kafka, http).",
      "items": { "type": "string" }
    },
    "visibility": {
      "type": "string",
      "enum": ["public", "internal", "prototype", "private"],
      "description": "Access level for the tile."
    },
    "requestUri": {
      "type": "string",
      "description": "URI or topic where requests are sent (e.g., kafka topic)."
    },
    "deploymentHints": {
      "type": "object",
      "description": "Container provisioning hints.",
      "properties": {
        "recommendedCpu": {
          "type": "number",
          "description": "The recommended number of CPUs for this tile to operate properly."
        },
        "recommendedMemory": {
          "type": "string",
          "description": "The recommended amount of RAM for this tile to operate properly."
        },
        "requiresGpu": {
          "type": "boolean",
          "description": "Flag indicating whether this tile requires a GPU."
        }
      },
      "additionalProperties": true
    },
    "runtimeMetadata": {
      "type": "object",
      "description": "Optional runtime-specific metadata (e.g., env vars).",
      "additionalProperties": true
    },
    "requestDefinitions": {
      "type": "array",
      "description": "List of tile-defined request operations.",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique identifier for this request (used by workflows)."
          },
          "version": {
            "type": "string",
            "description": "Version of this request definition."
          },
          "name": {
            "type": "string",
            "description": "Human-friendly name of the request."
          },
          "description": {
            "type": "string",
            "description": "What the request does."
          },
          "params": {
            "title": "RequestDefinitionParams",
            "type": "object",
            "description": "Input parameters accepted by this request.",
            "additionalProperties": {
              "$ref": "#/definitions/RequestParamDefinition"
            }
          },
          "executionHints": {
            "type": "object",
            "description": "Optional metadata describing the expected runtime characteristics of the request.",
            "properties": {
              "latencyClass": {
                "type": "string",
                "enum": ["trivial", "moderate", "heavy"],
                "description": "Rough qualitative latency estimate under typical load."
              },
              "scalesWith": {
                "type": "array",
                "description": "List of parameters that significantly influence runtime (like input size or graph density).",
                "items": { "type": "string" }
              },
              "estimatedComplexity": {
                "type": "string",
                "description": "Optional pseudo-complexity expression (e.g., O(n), O(n log n), O(n²))"
              },
              "stateless": {
                "type": "boolean",
                "description": "Whether the operation has no persistent side effects."
              },
              "costScore": {
                "type": "integer",
                "description": "Relative cost from 0–100 for scheduling, prioritization, or warnings."
              }
            },
            "additionalProperties": true
          }
        },
        "required": ["id", "version", "name", "description", "params"]
      }
    }
  },
  "required": [
    "tileId",
    "tileVersion",
    "displayName",
    "category",
    "subcategory",
    "type",
    "tags",
    "description",
    "supportedProtocols",
    "visibility",
    "requestDefinitions"
  ],
  "additionalProperties": false,
  "definitions": {
    "RequestParamDefinition": {
      "type": "object",
      "description": "Defines a parameter that the tile request accepts.",
      "properties": {
        "type": {
          "type": "string",
          "description": "Data type (e.g., string, int, float, boolean, set, map)."
        },
        "cardinality": {
          "type": "string",
          "description": "How many values are accepted (e.g., 1..1, 0..1, 2..n)."
        },
        "hint": {
          "type": "string",
          "description": "User-facing hint or guidance for this parameter."
        }
      },
      "required": ["type", "cardinality"],
      "additionalProperties": false
    }
  }
}
